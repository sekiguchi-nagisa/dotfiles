# for command-not-found handling

source atexit

function _cnf($s : Int, $e : Any) {
    if !($e is SystemError) {
        return;
    }
    which cnf 2>&1 > /dev/null || {
        return;
    }

    var ex = $e as SystemError
    var ss = $ex.message().split(": ")
    if $ss.size() != 3 { return; }
    if $ss[0] != 'execution error'|| $ss[2] != 'command not found' { return; }
    
    cnf $ss[1]
}

$atexit($ON_ERR, $_cnf)
